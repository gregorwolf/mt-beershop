{"version":3,"sources":["../../src/controller/ErrorHandler.ts"],"names":["ErrorHandler","UI5Object","constructor","component","resourceBundle","getModel","getResourceBundle","model","messageOpen","errorText","getText","attachMetadataFailed","event","responseText","getParameter","showServiceError","attachRequestFailed","response","statusCode","indexOf","details","JSON","parse","ex","MessageBox","error","id","styleClass","getContentDensityClass","onClose"],"mappings":";AA8BA;AACA;AACA;QACqBA,Y,GAAqBC,S;AAOzCC,IAAAA,W,wBAAYC,S,EAAwB;AACnC;AAEA,WAAKC,cAAL,GAAwBD,SAAS,CAACE,QAAV,CAAmB,MAAnB,CAAD,CAA8CC,iBAA9C,EAAvB;AACA,WAAKH,SAAL,GAAkBA,SAAlB;AACA,WAAKI,KAAL,GAAcJ,SAAS,CAACE,QAAV,EAAd;AACA,WAAKG,WAAL,GAAmB,KAAnB;AACA,WAAKC,SAAL,GAAiB,KAAKL,cAAL,CAAoBM,OAApB,CAA4B,WAA5B,CAAjB;AAEA,WAAKH,KAAL,CAAWI,oBAAX,CAAiCC,KAAD,IAAqB;AACpD,cAAMC,YAAY,GAAID,KAAK,CAACE,YAAN,CAAmB,UAAnB,CAAtB;AACA,aAAKC,gBAAL,CAAsBF,YAAtB;AACA,OAHD;AAIA,WAAKN,KAAL,CAAWS,mBAAX,CAAgCJ,KAAD,IAAqB;AACnD,cAAMK,QAAQ,GAAIL,KAAK,CAACE,YAAN,CAAmB,UAAnB,CAAlB,CADmD,CAEnD;AACA;AACA;;AACA,YAAIG,QAAQ,CAACC,UAAT,KAAwB,KAAxB,IAAkCD,QAAQ,CAACC,UAAT,IAAuB,KAAvB,IAAgCD,QAAQ,CAACJ,YAAT,CAAsBM,OAAtB,CAA8B,aAA9B,MAAiD,CAAvH,EAA2H;AAC1H,eAAKJ,gBAAL,CAAsBE,QAAtB;AACA;AACD,OARD;AASA,K;AAQOF,IAAAA,gB,6BAAiBK,O,EAAsB;AAC9C,UAAI,KAAKZ,WAAT,EAAsB;AACrB;AACA;;AACD,WAAKA,WAAL,GAAmB,IAAnB;AACA,UAAIK,YAAJ;;AAEA,UAAGO,OAAO,CAACP,YAAX,EAAwB;AACvB,YAAG;AACFA,UAAAA,YAAY,GAAIQ,IAAI,CAACC,KAAL,CAAWF,OAAO,CAACP,YAAnB,CAAhB;AACA,SAFD,CAEC,OAAMU,EAAN,EAAS;AACTV,UAAAA,YAAY,GAAGO,OAAO,CAACP,YAAvB;AACA;AACD;;AACDW,MAAAA,UAAU,CAACC,KAAX,CACC,KAAKhB,SADN,EAEC;AACCiB,QAAAA,EAAE,EAAE,wBADL;AAECN,QAAAA,OAAO,EAAGP,YAFX;AAGCc,QAAAA,UAAU,EAAE,KAAKxB,SAAL,CAAeyB,sBAAf,EAHb;AAIC;AACAC,QAAAA,OAAO,EAAE,MAAM;AACd,eAAKrB,WAAL,GAAmB,KAAnB;AACA;AAPF,OAFD;AAYA;;SA/DmBR,Y","sourcesContent":["import UI5Object from \"sap/ui/base/Object\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport { Action } from \"sap/m/MessageBox\";\n\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport UIComponent from \"sap/ui/core/UIComponent\";\nimport AppComponent from \"../Component\";\nimport ResourceModel from \"sap/ui/model/resource/ResourceModel\";\nimport UI5Event from \"sap/ui/base/Event\";\nimport ODataModel from \"sap/ui/model/odata/v2/ODataModel\";\n\ntype ui5Response = {\n\t/**\n\t * A text that describes the failure.\n\t */\n\tmessage?: string;\n\t/**\n\t * HTTP status code returned by the request (if available)\n\t */\n\tstatusCode?: string;\n\t/**\n\t * The status as a text, details not specified, intended only for diagnosis output\n\t */\n\tstatusText?: string;\n\t/**\n\t * Response that has been received for the request ,as a text string\n\t */\n\tresponseText?: string;\n};\n\n/**\n * @namespace be.wl.userscopes.controller\n */\nexport default class ErrorHandler extends UI5Object {\n\tprivate resourceBundle: ResourceBundle;\n\tprivate component: AppComponent;\n\tprivate model: ODataModel;\n\tprivate messageOpen: boolean;\n\tprivate errorText: string;\n\n\tconstructor(component: UIComponent) {\n\t\tsuper();\n\n\t\tthis.resourceBundle = ((component.getModel(\"i18n\") as ResourceModel).getResourceBundle() as ResourceBundle);\n\t\tthis.component = (component as AppComponent);\n\t\tthis.model = (component.getModel() as ODataModel);\n\t\tthis.messageOpen = false;\n\t\tthis.errorText = this.resourceBundle.getText(\"errorText\");\n\n\t\tthis.model.attachMetadataFailed((event: UI5Event) => {\n\t\t\tconst responseText = (event.getParameter(\"response\") as ui5Response);\n\t\t\tthis.showServiceError(responseText);\n\t\t});\n\t\tthis.model.attachRequestFailed((event: UI5Event) => {\n\t\t\tconst response = (event.getParameter(\"response\") as ui5Response);\n\t\t\t// An entity that was not found in the service is also throwing a 404 error in oData.\n\t\t\t// We already cover this case with a notFound target so we skip it here.\n\t\t\t// A request that cannot be sent to the server is a technical error that we have to handle though\n\t\t\tif (response.statusCode !== \"404\" || (response.statusCode == \"404\" && response.responseText.indexOf(\"Cannot POST\") === 0)) {\n\t\t\t\tthis.showServiceError(response);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Shows a {@link sap.m.MessageBox} when a service call has failed.\n\t * Only the first error message will be display.\n\t * @param {string} sDetails a technical error to be displayed on request\n\t * @private\n\t */\n\tprivate showServiceError(details: ui5Response) {\n\t\tif (this.messageOpen) {\n\t\t\treturn;\n\t\t}\n\t\tthis.messageOpen = true;\n\t\tlet responseText:any;\n\n\t\tif(details.responseText){\n\t\t\ttry{\n\t\t\t\tresponseText = (JSON.parse(details.responseText) as unknown);\n\t\t\t}catch(ex){\n\t\t\t\tresponseText = details.responseText;\n\t\t\t}\n\t\t}\n\t\tMessageBox.error(\n\t\t\tthis.errorText,\n\t\t\t{\n\t\t\t\tid: \"serviceErrorMessageBox\",\n\t\t\t\tdetails: (responseText as unknown as string),\n\t\t\t\tstyleClass: this.component.getContentDensityClass(),\n\t\t\t\t// actions : [Action.CLOSE],\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.messageOpen = false;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n}"],"file":"ErrorHandler.js"}